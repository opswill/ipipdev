<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>What is my IP address? — {{ string.upper(Host) }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
    content="What is my IP address? — Yet another tool to find your own IP address and glean information about it." />
  <link rel="canonical" href="https://{{ Host }}/" />

  <!-- CSS -->
  <link rel="stylesheet" href="https://unpkg.com/purecss/build/pure-min.css" />
  <link rel="stylesheet" href="https://unpkg.com/purecss/build/grids-responsive-min.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"  />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fontsource/open-sans/index.min.css" />

  <!-- JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  {( script.html )}
  {( styles.html )}
</head>

<body>
  <div class="content">
    <div class="pure-g gutters center">
      <div class="pure-u-1 pure-u-md-2-3">
        <div class="l-box">

          <h1>Find Your IP Address</h1>
          <p><code class="ip">{{ IP }}</code></p>
          <p>Yet another tool to find your own IP address and glean information about it.</p>

          <h2>IP Address Details & Intelligence</h2>
          <table class="info-table">

            <tr id="showIPv4" hidden>
              <th scope="row">IPv4 address</th>
              <td id="showIPv4Value">-</td>
            </tr>
            <tr id="showIPv6" hidden>
              <th scope="row">IPv6 address</th>
              <td id="showIPv6Value">-</td>
            </tr>

            {% for _, v in ipairs(context) do %}
              {% if v.Show and v.Value and v.Value ~= "" then %}
                <tr>
                  <th scope="row">{* v.Show *}</th>
                  <td>{* v.Value *}</td>
                </tr>
              {% end %}
            {% end %}

          </table>

          {% if Latitude and Longitude then %}
          <h2>Approximate Location on Map</h2>
          <div id="map"></div>
          {% end %}

          <h2>How to Access IP Data via API?</h2>
          <p>Build your query with the widget below and see the result.</p>

          <div class="input-buttons">
            <button name="ip" class="pure-button widget-select selected" onclick="changeInput('ip', this)">ip</button>

            {% 
            local added = {ip = true}
            for key, value in pairs(ipinfo or {}) do
              if not added[key] and key ~= "type" and key ~= "source" 
                 and value ~= nil and value ~= "" and type(value) ~= "table" then
                added[key] = true 
         %}
            <button name="{{key}}" class="pure-button widget-select" onclick="changeInput('{{key}}', this)">{{key}}</button>
         {% end end %}

         {% if not added.json then %}
            <button name="json" class="pure-button widget-select" onclick="changeInput('json', this)">json</button>
         {% end %}
          </div>

          <div class="widgetbox input"><code id="command">$ curl {{ Host }}/</code></div>
          <div id="output" class="widgetbox output"></div>

          <form class="pure-form input-buttons" onsubmit="handleSubmit(event)">
            <fieldset>
              <label>
                Check another IP or domain (optional)
                <input id="ipInput" type="text" placeholder="Lookup another IP, domain or hostname"
                  onkeyup="updateIP(this.value.trim())" autocomplete="off" />
              </label>
              <button type="submit" class="pure-button pure-button-primary">Query</button>
            </fieldset>
          </form>
          
          <h2>MCP Tool Server</h2>
          <p>
            Call IP intelligence directly from any IDE, editor, or AI chat that supports the Model Context Protocol.<br>
          </p>

          <h3>Currently available tool</h3>
          <ul>
            <li>
                <code><strong>ip_lookup: </strong></code>
                      IP or domain (resolves to IPv4) geolocation lookup. Returns country, region, city, ASN, ISP, and all other fields shown above. Leave the parameter empty to check your current IP.
            </li>
            <li>
                <code><strong>whois_lookup: </strong></code>
                      Query raw WHOIS record for a domain name, IP address, CIDR block or ASN. Returns the original detailed WHOIS record exactly as provided by the registrar or RIR.
            </li>
          </ul>

          <h3 >MCP endpoint</h3>
          <p><code class="ip">https://{{ Host }}/mcp</code></p>

          <h3>Usage notes:</h3>
          <ul>
            <li>Only <strong>Streamable HTTP</strong> transport is supported (required by most MCP clients).</li>
            <li>Add the URL above as a remote mcp server in VS Code, Cursor, Zed or any other MCP-compatible editor.</li>
            <li>Once connected, you can invoke <code>ip_lookup or whois_lookup</code> directly from your AI chat or code assistant.</li>
          </ul>

        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    <p>©2020-{{string.sub(ngx.today(),0,4)}} - <a href="//{{ngx.var.server_name}}">{{string.upper(ngx.var.server_name)}}</a> - <a href="https://github.com/opswill/ipipdev"> Source Code </a></p>
    <p style="font-size: 0.8em; color: #666; margin-top: 1em; padding: 0 1em;">
      This product includes GeoLite2 data created by MaxMind, available from <a href="https://www.maxmind.com" style="color: #007cba;">maxmind.com</a>.<br>
      Proxy detection powered by IP2Location LITE database, available from <a href="https://lite.ip2location.com" style="color: #007cba;">lite.ip2location.com</a>.
    </p>
  </div>

</body>
</html>
